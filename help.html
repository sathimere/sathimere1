<!DOCTYPE html>
<html>
<head>
<title>Help & Support</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="firebase.js"></script>

<style>
body{font-family:Arial;background:#fff0f8;margin:0;padding:0;}

.header{
    background:#ff1493;
    padding:15px;
    color:white;
    text-align:center;
    font-size:22px;
    font-weight:bold;
}

.container{
    padding:20px;
}

.input{
    width:100%;
    padding:12px;
    border:2px solid #ff1493;
    border-radius:8px;
    outline:none;
    font-size:16px;
    margin-bottom:15px;
}

.btn{
    width:100%;
    background:#ff1493;
    color:white;
    padding:12px;
    border:none;
    border-radius:8px;
    font-size:18px;
    cursor:pointer;
}

.card{
    background:white;
    padding:15px;
    border-radius:10px;
    margin-top:20px;
    box-shadow:0 0 10px #ffc1dc;
}
</style>

</head>
<body>

<div class="header">Help & Support</div>

<div class="container">

    <textarea id="msg" class="input" rows="5" placeholder="Explain your issue here..."></textarea>

    <button class="btn" onclick="sendHelp()">Submit Request</button>

    <div id="replyBox"></div>

</div>

<script>
auth.onAuthStateChanged(async user=>{
    if(!user) return window.location="login.html";
    loadReply(user.uid);
});

async function sendHelp(){
    let msg=document.getElementById("msg").value.trim();
    if(msg===""){ alert("Please write your issue."); return; }

    let user=auth.currentUser;

    await db.collection("support").add({
        uid: user.uid,
        message: msg,
        time: Date.now(),
        status: "pending",
        adminReply: ""
    });

    alert("Your request has been submitted. Support team will reply soon.");
    document.getElementById("msg").value="";
}

function loadReply(uid){
    db.collection("support")
      .where("uid","==",uid)
      .orderBy("time","desc")
      .onSnapshot(snap=>{
        let box=document.getElementById("replyBox");
        box.innerHTML="";

        snap.forEach(doc=>{
            let d=doc.data();
            box.innerHTML += `
            <div class="card">
                <b>Your Message:</b><br>${d.message}<br><br>
                <b>Status:</b> ${d.status}<br><br>
                <b>Admin Reply:</b><br>${d.adminReply || "No reply yet"}
            </div>
            `;
        });
      });
}
</script>

</body>
</html>
