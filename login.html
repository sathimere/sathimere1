<!DOCTYPE html>
<html>
<head>
  <title>Sathi Mere - Login</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

  <script src="firebase.js"></script>

  <style>
    body { font-family: Arial; background:#ffe4f0; padding:20px; }
    .box {
      max-width:360px; margin:auto; padding:25px;
      background:white; border-radius:15px;
      box-shadow:0 0 10px #ff9ac7;
    }
    input, select {
      width:100%; padding:12px; margin:8px 0;
      border:1px solid #ccc; border-radius:8px;
    }
    button {
      width:100%; padding:12px; background:#ff1493; color:white;
      border:none; margin-top:10px; font-size:16px;
      border-radius:8px; cursor:pointer;
    }
    .link { color:#ff1493; text-align:center; cursor:pointer; margin-top:10px; display:block;}
    h2 { text-align:center; color:#ff1493; }
  </style>
</head>

<body>

<h2>Sathi Mere</h2>

<!-- LOGIN -->
<div class="box" id="loginBox">
  <input type="email" id="emailInput" placeholder="Email">
  <input type="password" id="passwordInput" placeholder="Password">

  <button onclick="loginEmail()">Login</button>

  <span class="link" onclick="showSignup()">Create New Account</span>
  <span class="link" onclick="resetPassword()">Forgot Password?</span>

  <hr>
  <button onclick="googleStart()">Login with Google</button>
</div>


<!-- SIGNUP -->
<div class="box" id="signupBox" style="display:none;">
  <h3 style="text-align:center;color:#ff1493;">Create Account</h3>

  <input type="text" id="nameInput" placeholder="First Name">
  <input type="text" id="surnameInput" placeholder="Surname">

  <select id="genderInput">
    <option value="">Select Gender</option>
    <option value="Male">Male</option>
    <option value="Female">Female</option>
  </select>

  <input type="email" id="signupEmail" placeholder="Email">
  <input type="password" id="signupPass" placeholder="Password">

  <button onclick="createAccount()">Create Account</button>
  <span class="link" onclick="hideSignup()">Back to Login</span>
</div>


<!-- GOOGLE EXTRA FORM -->
<div class="box" id="googleForm" style="display:none;">
  <h3 style="text-align:center;color:#ff1493;">Complete Your Profile</h3>

  <input type="text" id="gName" placeholder="First Name">
  <input type="text" id="gSurname" placeholder="Surname">

  <select id="gGender">
    <option value="">Select Gender</option>
    <option value="Male">Male</option>
    <option value="Female">Female</option>
  </select>

  <button onclick="googleFinish()">Continue</button>
</div>


<script>

// LOGIN
function loginEmail() {
  let email = document.getElementById("emailInput").value;
  let pass = document.getElementById("passwordInput").value;

  auth.signInWithEmailAndPassword(email, pass)
    .then(() => {
      if (email === "sathimere.admin@gmail.com") {
        window.location = "admin.html";
      } else {
        window.location = "profile.html";  // ← changed ONLY THIS
      }
    })
    .catch(err => alert(err.message));
}


// SIGNUP
function createAccount() {
  let nm = nameInput.value;
  let sn = surnameInput.value;
  let g = genderInput.value;
  let em = signupEmail.value;
  let pw = signupPass.value;

  if (!nm || !sn || !g || !em || !pw) {
    alert("All fields required!");
    return;
  }

  auth.createUserWithEmailAndPassword(em, pw)
    .then(async (res) => {
      await db.collection("users").doc(res.user.uid).set({
        name: nm,
        surname: sn,
        gender: g,
        email: em,
        wallet: 0,
        createdAt: Date.now()
      });
      window.location = "profile.html"; // ← changed ONLY THIS
    })
    .catch(err => alert(err.message));
}


// RESET PASSWORD
function resetPassword() {
  let em = prompt("Enter your email:");
  if (!em) return;
  auth.sendPasswordResetEmail(em)
    .then(() => alert("Reset link sent"))
    .catch(err => alert(err.message));
}


// SHOW SIGNUP
function showSignup() {
  signupBox.style.display = "block";
  loginBox.style.display = "none";
}

// HIDE SIGNUP
function hideSignup() {
  signupBox.style.display = "none";
  loginBox.style.display = "block";
}



// GOOGLE LOGIN FLOW
let googleUserTemp = null;

function googleStart() {
  const provider = new firebase.auth.GoogleAuthProvider();
  auth.signInWithPopup(provider)
    .then((res) => {
      googleUserTemp = res.user;

      loginBox.style.display = "none";
      signupBox.style.display = "none";
      googleForm.style.display = "block";

      gName.value = googleUserTemp.displayName || "";
    })
    .catch(err => alert(err.message));
}


async function googleFinish() {
  let nm = gName.value;
  let sn = gSurname.value;
  let g = gGender.value;

  if (!nm || !sn || !g) {
    alert("All fields required!");
    return;
  }

  await db.collection("users").doc(googleUserTemp.uid).set({
    name: nm,
    surname: sn,
    gender: g,
    email: googleUserTemp.email,
    wallet: 0,
    createdAt: Date.now()
  });

  window.location = "profile.html"; // ← changed ONLY THIS
}

</script>

</body>
  </html>
