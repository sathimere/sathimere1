<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Profile</title>

<style>
body {
  margin: 0;
  padding: 15px;
  background: #ffe6f2;
  font-family: Arial;
}

.card {
  background: #fff;
  padding: 15px;
  border-radius: 12px;
  box-shadow: 0 0 10px #ff9acb;
}

input, select, textarea {
  width: 100%;
  padding: 10px;
  margin-top: 7px;
  border-radius: 8px;
  border: 1px solid #ff6fb7;
}

button {
  width: 100%;
  padding: 12px;
  margin-top: 12px;
  background: #ff4fa3;
  color: #fff;
  font-size: 18px;
  font-weight: bold;
  border: none;
  border-radius: 8px;
}

#profilePic {
  width: 120px;
  height: 120px;
  border-radius: 100%;
  display: block;
  margin: auto;
  object-fit: cover;
  border: 3px solid #ff4fa3;
  background: #fff;
}
</style>
</head>

<body>

<div class="card">

<h2 style="text-align:center;">My Profile</h2>
<img id="profilePic" src="default.jpg">

<label>Upload Photo</label>
<input type="file" id="photoUpload">

<label>Name</label>
<input type="text" id="name">

<label>Age</label>
<input type="number" id="age">

<label>Gender</label>
<select id="gender">
<option>Male</option>
<option>Female</option>
</select>

<label>Caste</label>
<input type="text" id="caste">

<label>Choice</label>
<input type="text" id="choice">

<label>State</label>
<input type="text" id="state">

<label>Location</label>
<input type="text" id="location">

<label>Interest</label>
<input type="text" id="interest">

<label>Bio</label>
<textarea id="bio"></textarea>

<label>Phone Privacy</label>
<select id="phonePrivacy">
<option value="public">Public</option>
<option value="private">Private</option>
</select>

<button onclick="saveProfile()">SAVE</button>

</div>

<!-- FIREBASE -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyCNujpIBIvJXMk34yQF1VeuTVFi5M7vdc0",
  authDomain: "sathimere-415fa.firebaseapp.com",
  databaseURL: "https://sathimere-415fa-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "sathimere-415fa",
  storageBucket: "sathimere-415fa.appspot.com",
  messagingSenderId: "290492321074",
  appId: "1:290492321074:web:05aa3d9abc2d3ab7635b2b"
};
firebase.initializeApp(firebaseConfig);

let uid = null;

// AUTH CHECK
firebase.auth().onAuthStateChanged(user => {
  if (!user) {
    window.location = "login.html";
  } else {
    uid = user.uid;
    loadProfile();
  }
});

// LOAD PROFILE
function loadProfile() {
  firebase.database().ref("users/" + uid).once("value").then(snap => {
    let d = snap.val();
    if (!d) return;

    if (d.photoURL) profilePic.src = d.photoURL;
    name.value = d.name || "";
    age.value = d.age || "";
    gender.value = d.gender || "";
    caste.value = d.caste || "";
    choice.value = d.choice || "";
    state.value = d.state || "";
    location.value = d.location || "";
    interest.value = d.interest || "";
    bio.value = d.bio || "";
    phonePrivacy.value = d.phonePrivacy || "public";
  });
}

// SAVE PROFILE
async function saveProfile() {
  let file = photoUpload.files[0];
  let photoURL = null;

  try {

    // Upload photo
    if (file) {
      let storeRef = firebase.storage().ref("profilePics/" + uid + ".jpg");
      let up = await storeRef.put(file);
      photoURL = await up.ref.getDownloadURL();
      profilePic.src = photoURL;
    }

    // Save data
    let data = {
      name: name.value,
      age: age.value,
      gender: gender.value,
      caste: caste.value,
      choice: choice.value,
      state: state.value,
      location: location.value,
      interest: interest.value,
      bio: bio.value,
      phonePrivacy: phonePrivacy.value
    };

    if (photoURL) data.photoURL = photoURL;

    await firebase.database().ref("users/" + uid).update(data);

    alert("Profile Saved âœ”");

  } catch (err) {
    alert("Error: " + err.message);
    console.log(err);
  }
}
</script>

</body>
  </html>
