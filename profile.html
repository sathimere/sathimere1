<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>My Profile</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>

<style>
body{
  margin:0;
  font-family: 'Poppins', Arial;
  background:#ffeef7;
}
.header{
  width:100%;
  background:#ff4da6;
  padding:25px 0;
  text-align:center;
  color:white;
  font-size:23px;
  font-weight:bold;
  border-radius:0 0 25px 25px;
  letter-spacing:1px;
}
.container{
  width:92%;
  margin:auto;
  margin-top:20px;
}
.profile-card{
  text-align:center;
  margin-top:-60px;
}
.profile-pic{
  width:140px;
  height:140px;
  border-radius:50%;
  border:5px solid white;
  box-shadow:0 0 10px rgba(0,0,0,0.15);
  object-fit:cover;
}
.change-btn{
  background:#ff4da6;
  color:white;
  border:none;
  padding:10px;
  width:100%;
  border-radius:8px;
  margin-top:8px;
  font-size:15px;
}
.box{
  background:white;
  padding:18px;
  margin-top:15px;
  border-radius:12px;
  box-shadow:0 0 8px rgba(0,0,0,0.08);
}
input, select, textarea{
  width:100%;
  padding:12px;
  border:1px solid #ccc;
  border-radius:8px;
  margin-top:7px;
  background:#fff;
  font-size:14px;
}
label{
  font-size:14px;
  color:#222;
  font-weight:600;
}

.row-2{
  display:flex;
  gap:10px;
}
.row-2 > div{
  flex:1;
}

.save-btn{
  background:#ff4da6;
  color:white;
  border:none;
  padding:15px;
  width:100%;
  border-radius:10px;
  margin-top:18px;
  font-size:17px;
  font-weight:bold;
  box-shadow:0 3px 10px rgba(255,77,166,0.3);
}
</style>
</head>

<body>

<div class="header">My Profile</div>

<div class="profile-card">
  <img id="profileImg" class="profile-pic" src="https://i.imgur.com/3G0P4tJ.png">
</div>

<div class="container">

  <input type="file" id="photo" style="display:none">
  <button class="change-btn" onclick="document.getElementById('photo').click()">Change Photo</button>

  <div class="box">

    <label>Surname</label>
    <input id="surname" type="text">

    <label>Name</label>
    <input id="name" type="text">

    <label>Father's Name</label>
    <input id="father" type="text">

    <label>Mother's Name</label>
    <input id="mother" type="text">

    <div class="row-2">
      <div>
        <label>Age</label>
        <input id="age" type="number">
      </div>
      <div>
        <label>Date of Birth</label>
        <input id="dob" type="date">
      </div>
    </div>

    <label>Email</label>
    <input id="email" type="text">

    <label>Mobile</label>
    <input id="mobile" type="text">

    <label>Mobile Visibility</label>
    <select id="mobilePrivacy">
      <option value="public">Public</option>
      <option value="private">Private</option>
    </select>

    <label>City</label>
    <input id="city" type="text">

    <label>State</label>
    <input id="state" type="text">

    <label>District</label>
    <input id="district" type="text">

    <label>Caste</label>
    <input id="caste" type="text">

    <label>Address</label>
    <textarea id="address"></textarea>

    <label>Gender</label>
    <select id="gender">
      <option value="">Select Gender</option>
      <option value="Male">Male</option>
      <option value="Female">Female</option>
      <option value="Other">Other</option>
    </select>

    <label>Choice (Partner Preference)</label>
    <textarea id="choice"></textarea>

    <label>Interest</label>
    <textarea id="interest"></textarea>

    <button class="save-btn" onclick="saveProfile()">Save Profile</button>
  </div>
</div>

<script>
// Firebase config (same as your original)
const firebaseConfig = {
  apiKey: "AIzaSyCNujpIBIvJXMk34yQF1VeuTVFi5M7vdc0",
  authDomain: "sathimere-415fa.firebaseapp.com",
  projectId: "sathimere-415fa",
  storageBucket: "sathimere-415fa.firebasestorage.app",
  messagingSenderId: "290492321074",
  appId: "1:290492321074:web:05aa3d9abc2d3ab7635b2b"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
const auth = firebase.auth();

auth.signInAnonymously();

const imgbbKey = "5d029a90e51dd6f7960ae7c3a7ac4200";

// LOAD DATA
auth.onAuthStateChanged(async (user)=>{
    let uid = user.uid;
    let doc = await db.collection("users").doc(uid).get();

    if(doc.exists){
        let d = doc.data();

        document.getElementById("surname").value = d.surname || "";
        document.getElementById("name").value = d.name || "";
        document.getElementById("father").value = d.father || "";
        document.getElementById("mother").value = d.mother || "";
        document.getElementById("age").value = d.age || "";
        document.getElementById("dob").value = d.dob || "";
        document.getElementById("email").value = d.email || "";
        document.getElementById("mobile").value = d.mobile || "";
        document.getElementById("mobilePrivacy").value = d.mobilePrivacy || "public";
        document.getElementById("city").value = d.city || "";
        document.getElementById("state").value = d.state || "";
        document.getElementById("district").value = d.district || "";
        document.getElementById("caste").value = d.caste || "";
        document.getElementById("address").value = d.address || "";
        document.getElementById("gender").value = d.gender || "";
        document.getElementById("choice").value = d.choice || "";
        document.getElementById("interest").value = d.interest || "";

        if(d.photo){
            document.getElementById("profileImg").src = d.photo;
        }
    }
});

// SAVE FUNCTION
async function saveProfile(){
    let user = auth.currentUser;
    let uid = user.uid;

    let surname = document.getElementById("surname").value;
    let name = document.getElementById("name").value;
    let father = document.getElementById("father").value;
    let mother = document.getElementById("mother").value;
    let age = document.getElementById("age").value;
    let dob = document.getElementById("dob").value;
    let email = document.getElementById("email").value;
    let mobile = document.getElementById("mobile").value;
    let mobilePrivacy = document.getElementById("mobilePrivacy").value;
    let city = document.getElementById("city").value;
    let state = document.getElementById("state").value;
    let district = document.getElementById("district").value;
    let caste = document.getElementById("caste").value;
    let address = document.getElementById("address").value;
    let gender = document.getElementById("gender").value;
    let choice = document.getElementById("choice").value;
    let interest = document.getElementById("interest").value;

    let fileInput = document.getElementById("photo");
    let photoURL = document.getElementById("profileImg").src;

    if(fileInput.files.length > 0){
        let file = fileInput.files[0];
        let base64 = await toBase64(file);

        let fd = new FormData();
        fd.append("key", imgbbKey);
        fd.append("image", base64.split(",")[1]);

        let res = await fetch("https://api.imgbb.com/1/upload", {
            method: "POST",
            body: fd
        });

        let json = await res.json();
        photoURL = json.data.url;
    }

    await db.collection("users").doc(uid).set({
        surname, name, father, mother, age, dob,
        email, mobile, mobilePrivacy,
        city, state, district, caste, address,
        gender, choice, interest,
        photo: photoURL
    });

    alert("Profile Updated Successfully!");
}

function toBase64(file){
    return new Promise((resolve,reject)=>{
        let r = new FileReader();
        r.onload = ()=>resolve(r.result);
        r.onerror = err=>reject(err);
        r.readAsDataURL(file);
    });
}
</script>

</body>
  </html>
