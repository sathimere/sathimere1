<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>My Profile</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>

<style>
body{
  margin:0;
  font-family: Arial;
  background:#f7f7f7;
}
.header{
  width:100%;
  background:#ff4da6;
  padding:25px 0;
  text-align:center;
  color:white;
  font-size:22px;
  font-weight:bold;
  border-radius:0 0 25px 25px;
}
.container{
  width:92%;
  margin:auto;
  margin-top:20px;
}
.profile-pic{
  width:130px;
  height:130px;
  border-radius:50%;
  border:4px solid white;
  margin-top:-70px;
  object-fit:cover;
}
.change-btn{
  background:#ff4da6;
  color:white;
  border:none;
  padding:10px;
  width:100%;
  border-radius:8px;
  margin-top:8px;
  font-size:15px;
}
.box{
  background:white;
  padding:18px;
  margin-top:15px;
  border-radius:12px;
  box-shadow:0 0 6px rgba(0,0,0,0.09);
}
input,select{
  width:100%;
  padding:12px;
  border:1px solid #ccc;
  border-radius:8px;
  margin-top:8px;
}
label{
  font-size:14px;
  color:#444;
}
.save-btn{
  background:#ff4da6;
  color:white;
  border:none;
  padding:15px;
  width:100%;
  border-radius:10px;
  margin-top:18px;
  font-size:17px;
}
</style>
</head>

<body>

<div class="header">My Profile</div>

<center>
<img id="profileImg" class="profile-pic" src="https://i.imgur.com/3G0P4tJ.png">
</center>
<div class="container">
  <input type="file" id="photo" style="display:none">
  <button class="change-btn" onclick="document.getElementById('photo').click()">Change Photo</button>

  <div class="box">
    <label>Name</label>
    <input id="name" type="text">

    <label>Email</label>
    <input id="email" type="text">

    <label>Mobile</label>
    <input id="mobile" type="text">

    <label>City</label>
    <input id="city" type="text">

    <label>State</label>
    <input id="state" type="text">

    <label>Gender</label>
    <select id="gender">
      <option value="">Select Gender</option>
      <option value="Male">Male</option>
      <option value="Female">Female</option>
      <option value="Other">Other</option>
    </select>

    <button class="save-btn" onclick="saveProfile()">Save Profile</button>
  </div>
</div>

<script>
// --------------------
//  YOUR FIREBASE CONFIG
// --------------------
const firebaseConfig = {
  apiKey: "AIzaSyCNujpIBIvJXMk34yQF1VeuTVFi5M7vdc0",
  authDomain: "sathimere-415fa.firebaseapp.com",
  projectId: "sathimere-415fa",
  storageBucket: "sathimere-415fa.firebasestorage.app",
  messagingSenderId: "290492321074",
  appId: "1:290492321074:web:05aa3d9abc2d3ab7635b2b"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
const auth = firebase.auth();

// Login anonymously
auth.signInAnonymously();

// ImgBB Key
const imgbbKey = "5d029a90e51dd6f7960ae7c3a7ac4200";

// --------------------
// LOAD PROFILE DATA
// --------------------
auth.onAuthStateChanged(async (user)=>{
    let uid = user.uid;

    let doc = await db.collection("users").doc(uid).get();
    if(doc.exists){
        let d = doc.data();

        document.getElementById("name").value = d.name || "";
        document.getElementById("email").value = d.email || "";
        document.getElementById("mobile").value = d.mobile || "";
        document.getElementById("city").value = d.city || "";
        document.getElementById("state").value = d.state || "";
        document.getElementById("gender").value = d.gender || "";

        if(d.photo){
            document.getElementById("profileImg").src = d.photo;
        }
    }
});

// --------------------
// SAVE PROFILE DATA
// --------------------
async function saveProfile(){
    let user = auth.currentUser;
    let uid = user.uid;

    let name = document.getElementById("name").value;
    let email = document.getElementById("email").value;
    let mobile = document.getElementById("mobile").value;
    let city = document.getElementById("city").value;
    let state = document.getElementById("state").value;
    let gender = document.getElementById("gender").value;

    let fileInput = document.getElementById("photo");
    let photoURL = document.getElementById("profileImg").src;

    // If new photo selected â†’ upload
    if(fileInput.files.length > 0){
        let file = fileInput.files[0];
        let base64 = await toBase64(file);

        let fd = new FormData();
        fd.append("key", imgbbKey);
        fd.append("image", base64.split(",")[1]);

        let res = await fetch("https://api.imgbb.com/1/upload", {
            method: "POST",
            body: fd
        });

        let json = await res.json();
        photoURL = json.data.url;
    }

    // Save to Firestore
    await db.collection("users").doc(uid).set({
        name, email, mobile, city, state, gender, photo: photoURL
    });

    alert("Profile updated!");
}


// Convert image to Base64
function toBase64(file){
    return new Promise((resolve,reject)=>{
        let r = new FileReader();
        r.onload = ()=>resolve(r.result);
        r.onerror = err=>reject(err);
        r.readAsDataURL(file);
    });
}
</script>

</body>
  </html>
