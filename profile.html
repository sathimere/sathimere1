<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Profile</title>

<style>
body {
  font-family: Arial, sans-serif;
  background: #ffe6f2;
  padding: 15px;
}

.container {
  background: #fff;
  padding: 15px;
  border-radius: 12px;
  box-shadow: 0 0 10px #ffb6d9;
}

input, select, textarea {
  width: 100%;
  padding: 10px;
  margin-top: 8px;
  border-radius: 8px;
  border: 1px solid #ff7fbd;
}

button {
  width: 100%;
  padding: 12px;
  margin-top: 12px;
  background: #ff4fa3;
  border: none;
  border-radius: 10px;
  color: #fff;
  font-size: 17px;
  font-weight: bold;
}
#profilePic {
  width: 120px;
  height: 120px;
  border-radius: 100%;
  object-fit: cover;
  border: 3px solid #ff4fa3;
  display: block;
  margin: 10px auto;
}
</style>
</head>

<body>
<div class="container">

<h2>Your Profile</h2>

<img id="profilePic" src="default.jpg">

<label>Upload Photo</label>
<input type="file" id="photoUpload">

<label>Name</label>
<input type="text" id="name">

<label>Age</label>
<input type="number" id="age">

<label>Gender</label>
<select id="gender">
  <option value="Male">Male</option>
  <option value="Female">Female</option>
</select>

<label>Caste</label>
<input type="text" id="caste">

<label>Choice</label>
<input type="text" id="choice">

<label>State</label>
<input type="text" id="state">

<label>Location</label>
<input type="text" id="location">

<label>Interest</label>
<input type="text" id="interest">

<label>Bio</label>
<textarea id="bio"></textarea>

<label>Phone Privacy</label>
<select id="phonePrivacy">
  <option value="public">Public</option>
  <option value="private">Private</option>
</select>

<button onclick="saveProfile()">Save Profile</button>

</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>

<script>

// ---------------- FIREBASE CONFIG (READY) ----------------
const firebaseConfig = {
  apiKey: "AIzaSyCNujpIBIvJXMk34yQF1VeuTVFi5M7vdc0",
  authDomain: "sathimere-415fa.firebaseapp.com",
  databaseURL: "https://sathimere-415fa-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "sathimere-415fa",
  storageBucket: "sathimere-415fa.appspot.com",
  messagingSenderId: "290492321074",
  appId: "1:290492321074:web:05aa3d9abc2d3ab7635b2b"
};

firebase.initializeApp(firebaseConfig);

let uid = null;

// ---------------- AUTH CHECK ----------------
firebase.auth().onAuthStateChanged(user => {
  if (!user) {
    window.location = "login.html";
  } else {
    uid = user.uid;
    loadProfile();
  }
});

// ---------------- LOAD PROFILE ----------------
function loadProfile() {
  firebase.database().ref("users/" + uid).once("value", snap => {
    let d = snap.val();
    if (!d) return;

    if (d.photoURL) document.getElementById("profilePic").src = d.photoURL;

    name.value = d.name || "";
    age.value = d.age || "";
    gender.value = d.gender || "";
    caste.value = d.caste || "";
    choice.value = d.choice || "";
    state.value = d.state || "";
    location.value = d.location || "";
    interest.value = d.interest || "";
    bio.value = d.bio || "";
    phonePrivacy.value = d.phonePrivacy || "public";
  });
}

// ---------------- SAVE PROFILE (100% WORKING PHOTO UPLOAD) ----------------
async function saveProfile() {
  let file = document.getElementById("photoUpload").files[0];
  let finalPhotoURL = null;

  try {

    // --- UPLOAD PHOTO ---
    if (file) {
      let storageRef = firebase.storage().ref("profilePics/" + uid + ".jpg");
      let upload = await storageRef.put(file);
      finalPhotoURL = await upload.ref.getDownloadURL();
      document.getElementById("profilePic").src = finalPhotoURL;
    }

    // --- SAVE DATA ---
    let data = {
      name: name.value,
      age: age.value,
      gender: gender.value,
      caste: caste.value,
      choice: choice.value,
      state: state.value,
      location: location.value,
      interest: interest.value,
      bio: bio.value,
      phonePrivacy: phonePrivacy.value
    };

    if (finalPhotoURL) data.photoURL = finalPhotoURL;

    await firebase.database().ref("users/" + uid).update(data);

    alert("Profile Saved Successfully âœ”");

  } catch (err) {
    alert("Error: " + err.message);
    console.log(err);
  }
}

</script>

</body>
</html>
