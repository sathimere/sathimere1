<!DOCTYPE html>
<html>
<head>
<title>Chat â€“ SathiMere</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  margin:0;
  background:#ffe3f4;
  font-family:Arial;
}
.header{
  background:#ff4da6;
  color:white;
  padding:15px;
  text-align:center;
  font-size:20px;
  font-weight:bold;
  position:sticky;
  top:0;
}
.chat-box{
  height:75vh;
  overflow-y:auto;
  padding:10px;
}
.msg{
  max-width:70%;
  padding:10px 14px;
  border-radius:14px;
  margin:8px 0;
  line-height:1.4;
}
.me{
  background:#ff4da6;
  color:white;
  margin-left:auto;
  border-bottom-right-radius:0;
}
.them{
  background:white;
  color:#333;
  margin-right:auto;
  border-bottom-left-radius:0;
}
.time{
  font-size:10px;
  margin-top:4px;
  text-align:right;
  opacity:0.6;
}
.input-area{
  display:flex;
  gap:8px;
  padding:10px;
  background:white;
  position:sticky;
  bottom:0;
}
input{
  flex:1;
  padding:12px;
  border:1px solid #ccc;
  border-radius:10px;
}
button{
  background:#ff4da6;
  color:white;
  padding:12px;
  border:none;
  border-radius:10px;
  width:80px;
  font-size:15px;
}
</style>
</head>
<body>

<div class="header" id="chatWith">Chat</div>

<div class="chat-box" id="chatBox"></div>

<div class="input-area">
  <input id="msgInput" placeholder="Type a message...">
  <button onclick="sendMsg()">Send</button>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyCNujpIBIvJXMk34yQF1VeuTVFi5M7vdc0",
  authDomain: "sathimere-415fa.firebaseapp.com",
  databaseURL: "https://sathimere-415fa-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "sathimere-415fa",
  storageBucket: "sathimere-415fa.firebasestorage.app",
  messagingSenderId: "290492321074",
  appId: "1:290492321074:web:05aa3d9abc2d3ab7635b2b"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

function getParam(n){
  return new URLSearchParams(location.search).get(n);
}

const me = getParam("me");
const to = getParam("to");

document.getElementById("chatWith").innerHTML = "Chat with " + to;

const chatID = me < to ? me + "_" + to : to + "_" + me;

// LOAD CHAT
db.ref("chats/" + chatID).on("child_added", snap => {
  const d = snap.val();
  showMsg(d);
});

// SHOW MESSAGE
function showMsg(d){
  let box = document.getElementById("chatBox");

  let div = document.createElement("div");
  div.className = "msg " + (d.from === me ? "me" : "them");
  div.innerHTML = `
    ${d.text}
    <div class='time'>${d.time}</div>
  `;

  box.appendChild(div);
  box.scrollTop = box.scrollHeight;
}

// SEND MESSAGE
function sendMsg(){
  let text = document.getElementById("msgInput").value.trim();
  if(!text) return;

  let time = new Date().toLocaleTimeString([], {hour:"2-digit", minute:"2-digit"});

  db.ref("chats/" + chatID).push({
    from: me,
    to: to,
    text: text,
    time: time
  });

  document.getElementById("msgInput").value = "";
}
</script>

</body>
</html>
