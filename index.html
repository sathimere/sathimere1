<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>SathiMere - Match</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
body{margin:0;font-family:Arial;background:#fff;color:#333;}
.topbar{height:55px;background:#ff4fa5;color:#fff;display:flex;align-items:center;justify-content:space-between;padding:0 15px;font-size:20px;position:fixed;width:100%;top:0;z-index:10;}
#menu{width:0;height:100%;position:fixed;top:0;left:0;background:#fff;overflow-x:hidden;transition:0.3s;padding-top:60px;box-shadow:3px 0 10px rgba(0,0,0,0.2);z-index:20;}
#menu a{padding:12px 20px;display:block;font-size:18px;color:#333;text-decoration:none;}
#menu a:hover{background:#ffe0f1;}
.closebtn{position:absolute;top:10px;right:10px;font-size:30px;}
.card{width:90%;margin:90px auto 80px;background:#fff;border-radius:15px;box-shadow:0 4px 15px rgba(0,0,0,0.1);overflow:hidden;text-align:center;}
.card img{width:100%;height:280px;object-fit:cover;}
.details{padding:15px;font-size:18px;}
.btn{background:#ff4fa5;color:#fff;padding:12px 20px;border-radius:10px;display:inline-block;margin:10px;text-decoration:none;font-weight:bold;cursor:pointer;}
.bottom-nav{position:fixed;bottom:0;width:100%;background:#fff;border-top:1px solid #ddd;display:flex;justify-content:space-around;padding:10px 0;box-shadow:0 -2px 10px rgba(0,0,0,0.1);}
.bottom-nav div{text-align:center;font-size:14px;color:#ff4fa5;font-weight:bold;display:flex;flex-direction:column;gap:3px;}
.icon{font-size:20px;}
#filterBox{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.4);display:none;justify-content:center;align-items:center;z-index:50;}
.filter-card{width:85%;background:#fff;padding:20px;border-radius:15px;box-shadow:0 4px 20px rgba(0,0,0,0.2);}
.filter-card input,.filter-card select{width:100%;padding:10px;margin:10px 0;border-radius:8px;border:1px solid #ccc;}
.f-btn{width:100%;background:#ff4fa5;padding:12px;border-radius:10px;color:#fff;margin-top:10px;font-weight:bold;text-align:center;}
.like-btn,.chat-btn{background:#ff1493;color:white;padding:10px 15px;margin:5px;border:none;border-radius:8px;cursor:pointer;}
.scroll-list{max-height:300px;overflow-y:auto;margin-top:10px;}
</style>

</head>
<body>

<div class="topbar">
<span onclick="openMenu()">‚ò∞</span>
SathiMere
<span onclick="openFilter()">‚öô</span>
</div>

<div id="menu">
<a class="closebtn" onclick="closeMenu()">‚úñ</a>
<a href="profile.html">My Profile</a>
<a href="wallet.html">Wallet</a>
<a href="terms.html">Terms & Conditions</a>
<a href="privacy.html">Privacy Policy</a>
<a href="adminhelp.html">Help</a>
<a onclick="logout()">Logout</a>
</div>

<div id="filterBox">
<div class="filter-card">
<h3>Filter Profiles</h3>
<input type="number" id="fAge" placeholder="Age (e.g. 18-30)">
<input type="text" id="fState" placeholder="State">
<input type="text" id="fCaste" placeholder="Caste">
<input type="text" id="fChoice" placeholder="Choice">
<div class="f-btn" onclick="applyFilter()">Apply Filter</div>
<div class="f-btn" style="background:#bbb" onclick="closeFilter()">Close</div>
</div>
</div>

<div id="userList" class="scroll-list"></div>

<div class="bottom-nav">
<div onclick="location.href='profile.html'"><span class="icon">üë§</span>Profile</div>
<div onclick="loadMatches()"><span class="icon">‚ù§Ô∏è</span>Match</div>
<div onclick="location.href='chat.html'"><span class="icon">üí¨</span>Chat</div>
</div>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyCNujpIBIvJXMk34yQF1VeuTVFi5M7vdc0",
  authDomain: "sathimere-415fa.firebaseapp.com",
  projectId: "sathimere-415fa",
  storageBucket: "sathimere-415fa.firebasestorage.app",
  messagingSenderId: "290492321074",
  appId: "1:290492321074:web:05aa3d9abc2d3ab7635b2b"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
const auth = firebase.auth();

/* UI */
function openMenu(){ document.getElementById("menu").style.width="250px"; }
function closeMenu(){ document.getElementById("menu").style.width="0"; }
function openFilter(){ document.getElementById("filterBox").style.display="flex"; }
function closeFilter(){ document.getElementById("filterBox").style.display="none"; }
function logout(){ auth.signOut().then(()=>location.href="login.html"); }

let currentUser=null;
let usersList=[];
let filters={};

/* Load Users */
auth.onAuthStateChanged(async user=>{
    if(!user) location.href="login.html";
    currentUser=user;
    loadUsers();
});

/* Filters */
function applyFilter(){
    filters.age=document.getElementById("fAge").value;
    filters.state=document.getElementById("fState").value;
    filters.caste=document.getElementById("fCaste").value;
    filters.choice=document.getElementById("fChoice").value;
    closeFilter();
    loadUsers();
}

async function loadUsers(){
    let html="";
    let q=await db.collection("users").get();
    q.forEach(doc=>{
        let u=doc.data();
        let ageOk=!filters.age || u.age==filters.age;
        let stateOk=!filters.state || (u.state && u.state.toLowerCase().includes(filters.state.toLowerCase()));
        let casteOk=!filters.caste || (u.caste && u.caste.toLowerCase().includes(filters.caste.toLowerCase()));
        let choiceOk=!filters.choice || (u.choice && u.choice.toLowerCase().includes(filters.choice.toLowerCase()));
        if(ageOk && stateOk && casteOk && choiceOk){
            html+=`<div class="card">
            <img src="${u.photo||'https://via.placeholder.com/300'}">
            <div class="details">
            <b>${u.name} ${u.surname}</b> | Age:${u.age||"-"}<br>
            Gender: ${u.gender||"-"}<br>
            <button class="like-btn" onclick="sendLike('${doc.id}')">üíú Like</button>
            <button class="chat-btn" onclick="sendRequest('${doc.id}')">Chat Request</button>
            </div></div>`;
        }
    });
    document.getElementById("userList").innerHTML=html||"<p>No users found.</p>";
}

/* Like / Chat logic */
async function sendLike(uid){
    await db.collection("likes").doc(uid+"_"+currentUser.uid).set({
        from:currentUser.uid,
        to:uid,
        createdAt:Date.now()
    });
    alert("Liked successfully!");
}

async function sendRequest(uid){
    await db.collection("requests").doc(uid+"_"+currentUser.uid).set({
        from:currentUser.uid,
        to:uid,
        status:"pending",
        createdAt:Date.now()
    });
    alert("Request sent!");
}
</script>

</body>
    </html>
